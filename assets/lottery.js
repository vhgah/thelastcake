let ABI=[{"inputs":[{"internalType":"string","name":"name","type":"string"},{"internalType":"string","name":"symbol","type":"string"},{"internalType":"address","name":"routerAddress","type":"address"},{"internalType":"address","name":"vrfCoordinator","type":"address"},{"internalType":"address","name":"link","type":"address"},{"internalType":"address","name":"linkPeg","type":"address"},{"internalType":"address","name":"pegSwap","type":"address"},{"internalType":"bytes32","name":"_keyHash","type":"bytes32"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"message","type":"string"}],"name":"RaffleWarning","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"tokensSwapped","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"ethReceived","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"tokensIntoLiqudity","type":"uint256"}],"name":"SwapAndLiquify","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"SwapForRaffle","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"generalAmount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"addedToPot","type":"uint256"}],"name":"WhaleAlert","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"winnerAddress","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"WinnerPaid","type":"event"},{"inputs":[],"name":"WETH","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_liquidityBalanceForPeriod","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_liquidityFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_lotteryBalanceForPeriod","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_lotteryBalanceInBNBForLastPeriod","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_lotteryFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_maxTxAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_taxFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"cleanUpFactor","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"cleanUpPreviousParticipantSets","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"wallet","type":"address"}],"name":"containsRaffleParticipant","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"currentRaffleParticipantSetIndex","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"subtractedValue","type":"uint256"}],"name":"decreaseAllowance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tAmount","type":"uint256"}],"name":"deliver","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"excludeFromFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"excludeFromReward","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"includeInFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"includeInReward","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"addedValue","type":"uint256"}],"name":"increaseAllowance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"isExcludedFromFee","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"isExcludedFromReward","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"lengthRaffleParticipants","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"linkAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"linkFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"linkPair","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"linkPegAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"linkPegContract","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"minRaffleEntryAmountBnb","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pancakeswapV2Pair","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pancakeswapV2Router","outputs":[{"internalType":"contract IPancakeRouter02","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pegSwapAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pegSwapContract","outputs":[{"internalType":"contract PegSwap","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"raffleInterval","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"raffleLastTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"raffleMinParticipants","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"raffleNextTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"raffleRandomResult","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"raffleThresholdHugeBuySell","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"raffleWinner","outputs":[{"internalType":"address payable","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"raffleWinnerPaid","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"requestId","type":"bytes32"},{"internalType":"uint256","name":"randomness","type":"uint256"}],"name":"rawFulfillRandomness","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"tokenAddress","type":"address"},{"internalType":"uint256","name":"tokenAmount","type":"uint256"}],"name":"recoverERC20","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tAmount","type":"uint256"},{"internalType":"bool","name":"deductTransferFee","type":"bool"}],"name":"reflectionFromToken","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint8","name":"_cleanUpFactor","type":"uint8"}],"name":"setCleanUpFactor","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_linkFee","type":"uint256"}],"name":"setLinkFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"liquidityFee","type":"uint256"}],"name":"setLiquidityFeePercent","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"lotteryFee","type":"uint256"}],"name":"setLotteryFeePercent","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"maxTxPercent","type":"uint256"}],"name":"setMaxTxPercent","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_minRaffleEntryAmount","type":"uint256"}],"name":"setMinRaffleEntryAmount","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_numTokensSellForLottery","type":"uint256"}],"name":"setNumTokensSellForLottery","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_numTokensSellToAddToLiquidity","type":"uint256"}],"name":"setNumTokensSellToAddToLiquidity","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_raffleInterval","type":"uint256"}],"name":"setRaffleInterval","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_raffleNextTime","type":"uint256"}],"name":"setRaffleNextTime","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_raffleThresholdHugeBuySell","type":"uint256"}],"name":"setRaffleThresholdHugeBuySell","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bool","name":"_enabled","type":"bool"}],"name":"setSwapAndLiquifyEnabled","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bool","name":"_enabled","type":"bool"}],"name":"setSwapForRaffleEnabled","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint8","name":"_swapLinkSlippageFactor","type":"uint8"}],"name":"setSwapLinkSlippageFactor","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"taxFee","type":"uint256"}],"name":"setTaxFeePercent","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint8","name":"_tokenBnbEntryPriceSlippage","type":"uint8"}],"name":"setTokenBnbEntryPriceSlippage","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"swapAndLiquifyEnabled","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"swapForRaffleEnabled","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"swapLinkSlippageFactor","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"tokenBnbEntryPriceSlippage","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"rAmount","type":"uint256"}],"name":"tokenFromReflection","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalFees","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"recipient","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"sender","type":"address"},{"internalType":"address","name":"recipient","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}]
const CTR_ADDRESS='0x29f920ddc62Fe53711a5c8B8FF16Fa5c75cA12A3';let contractInstance;let web3Interface;let unixTimestamp;let latestWinner;let latestWinnerAmountFullDecimal;let latestWinnerAmount;let latestWinnerAmountUsd;let minEntryAmount;let interval;let poolSize;let lotteryBalanceForPeriod;const connectToNode=()=>{const mainNodes=["https://bsc-dataseed.binance.org/","https://bsc-dataseed1.defibit.io/","https://bsc-dataseed1.ninicoin.io/"]
let usedNode=mainNodes[Math.floor(Math.random()*mainNodes.length)]
if(typeof web3Interface!=='undefined'){web3Interface=new Web3(web3Interface.currentProvider);}else{if(!usedNode){web3Interface=new Web3('https://bsc-dataseed.binance.org/')}else{web3Interface=new Web3(usedNode)}}
contractInstance=new web3Interface.eth.Contract(ABI,CTR_ADDRESS);}
const fetchRaffleTime=async()=>{return await contractInstance.methods.raffleNextTime().call();}
const queryForAddress=async(address)=>{return await contractInstance.methods.containsRaffleParticipant(address).call();}
function makeBatchRequest(calls){let batch=new web3Interface.BatchRequest();let promises=calls.map(call=>{return new Promise((res,rej)=>{let req=call.request((err,data)=>{if(err)rej(err);else res(data)});batch.add(req)})})
batch.execute()
return Promise.all(promises)}
const createMinEntryAmountRounded=(amount)=>{if(amount>0.01){return Math.round(parseFloat(web3Interface.utils.fromWei(amount))*100)/100}}
const createPoolFigure=(amount)=>{return Math.round(parseFloat(web3Interface.utils.fromWei(amount))*100)/100}
const fetchUSDollarPrice=()=>{return fetch('https://api.coingecko.com/api/v3/simple/price?ids=binancecoin&vs_currencies=USD').then(usDollar=>usDollar.json()).then(dollar=>dollar);}
const checkForRaffleTime=async()=>{let hours='00';let minutes='00';let raffleTime=await fetchRaffleTime();let distance=new Date(raffleTime*1000).getTime()-new Date().getTime();if(distance>0){hours=Math.floor((distance%(1000*60*60*24))/(1000*60*60));minutes=Math.floor((distance%(1000*60*60))/(1000*60));if(hours.toString().length===1){hours='0'+hours;}
if(minutes.toString().length===1){minutes='0'+minutes;}}
document.querySelector(".hours").innerHTML=hours.toString();document.querySelector(".min").innerHTML=minutes.toString();}
const initiate=async()=>{connectToNode();poolSize=await web3Interface.eth.getBalance(CTR_ADDRESS)
try{await makeBatchRequest([contractInstance.methods.raffleNextTime().call,contractInstance.methods.raffleWinner().call,contractInstance.methods.minRaffleEntryAmountBnb().call,contractInstance.methods.raffleInterval().call,contractInstance.methods._lotteryBalanceInBNBForLastPeriod().call,contractInstance.methods._lotteryBalanceForPeriod().call,]).then(res=>{unixTimestamp=res[0];latestWinner=res[1];minEntryAmount=res[2];interval=res[3];latestWinnerAmountFullDecimal=web3Interface.utils.fromWei(res[4]);latestWinnerAmount=round(latestWinnerAmountFullDecimal);lotteryBalanceForPeriod=res[5]})}catch(e){console.error('Node down',e);document.getElementById('sectionContainer').innerText='Unable to fetch lottery data'
document.getElementById('sectionContainer').classList.add('node-down')}}
(async()=>{await initiate();let usdPrice=await fetchUSDollarPrice();latestWinnerAmountUsd=round(latestWinnerAmountFullDecimal*usdPrice.binancecoin.usd);document.getElementById('buy-text').innerText=`Buy ${createMinEntryAmountRounded(minEntryAmount)} BNB worth of $LOTDOG before Timer runs out for a chance to win!`
document.getElementById('winner-address-link').innerHTML=`<a target="_blank" href=https://bscscan.com/address/${latestWinner}> Last Winner ${latestWinnerAmount} BNB / ${latestWinnerAmountUsd} USD </a>`;document.getElementById('currAmount').innerText=createPoolFigure(poolSize)+' BNB'
document.getElementById('raffleParticipantBtn').addEventListener('click',async()=>{let data=document.getElementById('raffleParticipantInput').value;try{if(/^0x[a-fA-F0-9]{40}$/.test(data)){let res=await queryForAddress(data);if(res){document.getElementById('inputRes').innerHTML='đŸ˜ You\'re registered for this round!'}else{let addr="https://exchange.pancakeswap.finance/#/swap?outputCurrency="+CTR_ADDRESS;document.getElementById('inputRes').innerHTML='You\'re not registered. '+`<a class="minor-btn" target="_blank" href="${addr}">get LOTDOG</a>`}}else{document.getElementById('inputRes').innerHTML='đŸ˜• Ouch! This address seems to be invalid!'}}catch(e){document.getElementById('inputRes').innerHTML='đŸ˜• Ouch! This address seems to be invalid!'}})
await checkForRaffleTime();setInterval(async()=>{await checkForRaffleTime();},60000);})();function round(num){var m=Number((Math.abs(num)*100).toPrecision(15));return Math.round(m)/100*Math.sign(num);}
1